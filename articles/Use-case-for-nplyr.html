<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nplyr">
<title>Use case for nplyr • nplyr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use case for nplyr">
<meta property="og:description" content="nplyr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nplyr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Use-case-for-nplyr.html">Use case for nplyr</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/markjrieke/nplyr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Use case for nplyr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/markjrieke/nplyr/blob/HEAD/vignettes/Use-case-for-nplyr.Rmd" class="external-link"><code>vignettes/Use-case-for-nplyr.Rmd</code></a></small>
      <div class="d-none name"><code>Use-case-for-nplyr.Rmd</code></div>
    </div>

    
    
<p>The package README uses the <a href="https://cran.r-project.org/web/packages/gapminder/index.html" class="external-link">gapminder dataset</a> to demonstrate nplyr’s functionality. In this case (and other similar cases) the outuput from nplyr’s nested operations could be obtained by unnesting and performing grouped dplyr operations.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/markjrieke/nplyr" class="external-link">nplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">gm_nest</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">gapminder</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/gapminder/man/gapminder_unfiltered.html" class="external-link">gapminder_unfiltered</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span>country_data <span class="op">=</span> <span class="op">-</span><span class="va">continent</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gm_nest</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   continent country_data        </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Asia      <span style="color: #949494;">&lt;tibble [578 × 5]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Europe    <span style="color: #949494;">&lt;tibble [1,302 × 5]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Africa    <span style="color: #949494;">&lt;tibble [637 × 5]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Americas  <span style="color: #949494;">&lt;tibble [470 × 5]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> FSU       <span style="color: #949494;">&lt;tibble [139 × 5]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Oceania   <span style="color: #949494;">&lt;tibble [187 × 5]&gt;</span></span></span>
<span></span>
<span><span class="co"># we can use nplyr to perform operations on the nested data</span></span>
<span><span class="va">gm_nest</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nest_filter.html">nest_filter</a></span><span class="op">(</span><span class="va">country_data</span>, <span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nest_mutate.html">nest_mutate</a></span><span class="op">(</span><span class="va">country_data</span>, pop_millions <span class="op">=</span> <span class="va">pop</span><span class="op">/</span><span class="fl">1000000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">country_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 43 × 7</span></span></span>
<span><span class="co">#&gt;    continent country           year lifeExp        pop gdpPercap pop_millions</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Asia      Afghanistan       <span style="text-decoration: underline;">2</span>007    43.8   31<span style="text-decoration: underline;">889</span>923      975.       31.9  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Asia      Azerbaijan        <span style="text-decoration: underline;">2</span>007    67.5    8<span style="text-decoration: underline;">017</span>309     <span style="text-decoration: underline;">7</span>709.        8.02 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Asia      Bahrain           <span style="text-decoration: underline;">2</span>007    75.6     <span style="text-decoration: underline;">708</span>573    <span style="text-decoration: underline;">29</span>796.        0.709</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Asia      Bangladesh        <span style="text-decoration: underline;">2</span>007    64.1  150<span style="text-decoration: underline;">448</span>339     <span style="text-decoration: underline;">1</span>391.      150.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Asia      Bhutan            <span style="text-decoration: underline;">2</span>007    65.6    2<span style="text-decoration: underline;">327</span>849     <span style="text-decoration: underline;">4</span>745.        2.33 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Asia      Brunei            <span style="text-decoration: underline;">2</span>007    77.1     <span style="text-decoration: underline;">386</span>511    <span style="text-decoration: underline;">48</span>015.        0.387</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Asia      Cambodia          <span style="text-decoration: underline;">2</span>007    59.7   14<span style="text-decoration: underline;">131</span>858     <span style="text-decoration: underline;">1</span>714.       14.1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Asia      China             <span style="text-decoration: underline;">2</span>007    73.0 <span style="text-decoration: underline;">1</span>318<span style="text-decoration: underline;">683</span>096     <span style="text-decoration: underline;">4</span>959.     <span style="text-decoration: underline;">1</span>319.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Asia      Hong Kong, China  <span style="text-decoration: underline;">2</span>007    82.2    6<span style="text-decoration: underline;">980</span>412    <span style="text-decoration: underline;">39</span>725.        6.98 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Asia      India             <span style="text-decoration: underline;">2</span>007    64.7 <span style="text-decoration: underline;">1</span>110<span style="text-decoration: underline;">396</span>331     <span style="text-decoration: underline;">2</span>452.     <span style="text-decoration: underline;">1</span>110.   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 33 more rows</span></span></span>
<span></span>
<span><span class="co"># in this case, we could have obtained the same result with tidyr and dplyr</span></span>
<span><span class="va">gm_nest</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">country_data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pop_millions <span class="op">=</span> <span class="va">pop</span><span class="op">/</span><span class="fl">1000000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Asia"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 43 × 7</span></span></span>
<span><span class="co">#&gt;    continent country           year lifeExp        pop gdpPercap pop_millions</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Asia      Afghanistan       <span style="text-decoration: underline;">2</span>007    43.8   31<span style="text-decoration: underline;">889</span>923      975.       31.9  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Asia      Azerbaijan        <span style="text-decoration: underline;">2</span>007    67.5    8<span style="text-decoration: underline;">017</span>309     <span style="text-decoration: underline;">7</span>709.        8.02 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Asia      Bahrain           <span style="text-decoration: underline;">2</span>007    75.6     <span style="text-decoration: underline;">708</span>573    <span style="text-decoration: underline;">29</span>796.        0.709</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Asia      Bangladesh        <span style="text-decoration: underline;">2</span>007    64.1  150<span style="text-decoration: underline;">448</span>339     <span style="text-decoration: underline;">1</span>391.      150.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Asia      Bhutan            <span style="text-decoration: underline;">2</span>007    65.6    2<span style="text-decoration: underline;">327</span>849     <span style="text-decoration: underline;">4</span>745.        2.33 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Asia      Brunei            <span style="text-decoration: underline;">2</span>007    77.1     <span style="text-decoration: underline;">386</span>511    <span style="text-decoration: underline;">48</span>015.        0.387</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Asia      Cambodia          <span style="text-decoration: underline;">2</span>007    59.7   14<span style="text-decoration: underline;">131</span>858     <span style="text-decoration: underline;">1</span>714.       14.1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Asia      China             <span style="text-decoration: underline;">2</span>007    73.0 <span style="text-decoration: underline;">1</span>318<span style="text-decoration: underline;">683</span>096     <span style="text-decoration: underline;">4</span>959.     <span style="text-decoration: underline;">1</span>319.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Asia      Hong Kong, China  <span style="text-decoration: underline;">2</span>007    82.2    6<span style="text-decoration: underline;">980</span>412    <span style="text-decoration: underline;">39</span>725.        6.98 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Asia      India             <span style="text-decoration: underline;">2</span>007    64.7 <span style="text-decoration: underline;">1</span>110<span style="text-decoration: underline;">396</span>331     <span style="text-decoration: underline;">2</span>452.     <span style="text-decoration: underline;">1</span>110.   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 33 more rows</span></span></span></code></pre></div>
<p>Why, then, might we need to use nplyr? Well, in other scenarios, it may be far more convenient to work with nested data frames or it may not even be possible to unnest!</p>
<div class="section level2">
<h2 id="a-motivating-example">A motivating example<a class="anchor" aria-label="anchor" href="#a-motivating-example"></a>
</h2>
<p>Consider a set of surveys that an organization might use to gather market data. It is common for organizations to have separate surveys for separate purposes but gather the same baseline set of data across all surveys (for example, a respondent’s age and gender may be recorded across all surveys, but each survey will have a different set of questions). Let’s use two fake surveys with the below questions for this example:</p>
<div class="section level6">
<h6 id="survey-1-job">Survey 1: Job<a class="anchor" aria-label="anchor" href="#survey-1-job"></a>
</h6>
<ol style="list-style-type: decimal">
<li>How old are you? (multiple choice)</li>
<li>What city do you live in? (multiple choice)</li>
<li>What field do you work in? (multiple choice)</li>
<li>Overall, how satisfied are you with your job? (multiple choice)</li>
<li>What is your annual salary? (numeric entry)</li>
</ol>
</div>
<div class="section level6">
<h6 id="survey-2-personal-life">Survey 2: Personal Life<a class="anchor" aria-label="anchor" href="#survey-2-personal-life"></a>
</h6>
<ol style="list-style-type: decimal">
<li>How old are you? (multiple choice)</li>
<li>What city do you live in (multiple choice)</li>
<li>What field do you work in? (multiple choice)</li>
<li>Overall, how satisfied are you with your personal life (multiple choice)</li>
<li>Please provide additional detail (text entry)</li>
</ol>
<p>In this scenario, both surveys are collecting demographic information — age, location, and industry — but differ in the questions. A convenient way to get the response files into the environment would be to use <a href="https://purrr.tidyverse.org/reference/map.html" class="external-link"><code>purrr::map()</code></a> to read in each file to a nested data frame.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/markjrieke/nplyr/main/data-raw/"</span></span>
<span></span>
<span><span class="va">surveys</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>survey_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"job_survey"</span>, <span class="st">"personal_survey"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>survey_data <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">survey_file</span>, <span class="op">~</span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">.x</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surveys</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   survey_file     survey_data            </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>                 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> job_survey      <span style="color: #949494;">&lt;spec_tbl_df [500 × 6]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> personal_survey <span style="color: #949494;">&lt;spec_tbl_df [750 × 6]&gt;</span></span></span></code></pre></div>
<p><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link"><code>tidyr::unnest()</code></a> can usually handle idiosyncrasies in layout when unnesting but in this case unnesting throws an error!</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;">:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Can't combine `Q5` &lt;double&gt; and `Q5` &lt;character&gt;.</span></span></code></pre></div>
<p>This is because the surveys share column names but not necessarily column types! In this case, both data frames contain a column named “Q5”, but in <code>job_survey</code> it’s a double and in <code>personal_survey</code> it’s a character.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 500</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; $ survey_file <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "job_survey", "job_survey", "job_survey", "job_survey", "j…</span></span>
<span><span class="co">#&gt; $ survey_name <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "job", "job", "job", "job", "job", "job", "job", "job", "j…</span></span>
<span><span class="co">#&gt; $ Q1          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 100, 81, 51, 81, 80, 32, 65, 57, 43, 94, 25, 83, 61, 66, 8…</span></span>
<span><span class="co">#&gt; $ Q2          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Austin", "San Antonio", "Austin", "Austin", "Dallas", "Fo…</span></span>
<span><span class="co">#&gt; $ Q3          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Consulting", "Consulting", "Consulting", "Technology", "C…</span></span>
<span><span class="co">#&gt; $ Q4          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Somewhat dissatisfied", "Neither satisfied nor dissatisfi…</span></span>
<span><span class="co">#&gt; $ Q5          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 163, 48, 190, 25, 143, 233, 43, 243, 158, 235, 245, 195, 2…</span></span>
<span></span>
<span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 750</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; $ survey_file <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "personal_survey", "personal_survey", "personal_survey", "…</span></span>
<span><span class="co">#&gt; $ survey_name <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "personal", "personal", "personal", "personal", "personal"…</span></span>
<span><span class="co">#&gt; $ Q1          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 91, 32, 40, 23, 88, 69, 96, 40, 57, 40, 39, 70, 29, 38, 57…</span></span>
<span><span class="co">#&gt; $ Q2          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Austin", "San Antonio", "San Antonio", "Austin", "Dallas"…</span></span>
<span><span class="co">#&gt; $ Q3          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Energy", "Healthcare", "Consulting", "Consulting", "Techn…</span></span>
<span><span class="co">#&gt; $ Q4          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Neither satisfied nor dissatisfied", "Extremely satisfied…</span></span>
<span><span class="co">#&gt; $ Q5          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Blandit eros! A, ligula facilisis imperdiet! Interdum pla…</span></span></code></pre></div>
<p>We could potentially get around this issue with unnesting by reading in all columns as characters via <code>readr::read_csv(x, col_types = cols(.default = "c"))</code>, but this presents its own challenges. <code>Q5</code> would still be better represented as a double in <code>job_survey</code> and from the survey question text <code>Q4</code> has similar, but distinctly different, meanings across the survey files.</p>
<p>This is where nplyr comes into play! Rather than malign the data types or create separate objects for each survey file, we can use nplyr to perform operations directly on the nested data frames.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nest_mutate.html">nest_mutate</a></span><span class="op">(</span><span class="va">survey_data</span>,</span>
<span>              age_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">Q1</span> <span class="op">&lt;</span> <span class="fl">65</span>, <span class="st">"Adult"</span>, <span class="st">"Retirement Age"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nest_group_by.html">nest_group_by</a></span><span class="op">(</span><span class="va">survey_data</span>, <span class="va">Q3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nest_count.html">nest_add_count</a></span><span class="op">(</span><span class="va">survey_data</span>, </span>
<span>                 name <span class="op">=</span> <span class="st">"n_respondents_in_industry"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nest_mutate.html">nest_mutate</a></span><span class="op">(</span><span class="va">survey_data</span>, </span>
<span>              median_industry_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">Q1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nest_group_by.html">nest_ungroup</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 500 × 10</span></span></span>
<span><span class="co">#&gt;    survey_file survey_name    Q1 Q2          Q3            Q4       Q5 age_group</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> job_survey  job           100 Austin      Consulting    Some…   163 Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> job_survey  job            81 San Antonio Consulting    Neit…    48 Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> job_survey  job            51 Austin      Consulting    Extr…   190 Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> job_survey  job            81 Austin      Technology    Extr…    25 Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> job_survey  job            80 Dallas      Consulting    Extr…   143 Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> job_survey  job            32 Fort Worth  Energy        Some…   233 Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> job_survey  job            65 Dallas      Consulting    Some…    43 Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> job_survey  job            57 Houston     Healthcare    Some…   243 Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> job_survey  job            43 Dallas      Government S… Neit…   158 Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> job_survey  job            94 Fort Worth  Healthcare    Extr…   235 Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 490 more rows, and 2 more variables: n_respondents_in_industry &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   median_industry_age &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="va">surveys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 750 × 10</span></span></span>
<span><span class="co">#&gt;    survey_file     survey_name    Q1 Q2          Q3        Q4    Q5    age_group</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> personal_survey personal       91 Austin      Energy    Neit… Blan… Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> personal_survey personal       32 San Antonio Healthca… Extr… Elem… Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> personal_survey personal       40 San Antonio Consulti… Some… Eget… Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> personal_survey personal       23 Austin      Consulti… Extr… Scel… Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> personal_survey personal       88 Dallas      Technolo… Neit… Aene… Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> personal_survey personal       69 Fort Worth  Technolo… Neit… Inte… Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> personal_survey personal       96 Houston     Healthca… Extr… Blan… Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> personal_survey personal       40 Houston     Consulti… Extr… Scel… Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> personal_survey personal       57 Fort Worth  Energy    Extr… Pede… Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> personal_survey personal       40 Fort Worth  Healthca… Extr… Phar… Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 740 more rows, and 2 more variables: n_respondents_in_industry &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   median_industry_age &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Mark Rieke.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
