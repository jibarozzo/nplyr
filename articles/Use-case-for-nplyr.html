<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Use case for nplyr • nplyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use case for nplyr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nplyr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Use-case-for-nplyr.html">Use case for nplyr</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jibarozzo/nplyr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Use case for nplyr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jibarozzo/nplyr/blob/0.3.0/vignettes/Use-case-for-nplyr.Rmd" class="external-link"><code>vignettes/Use-case-for-nplyr.Rmd</code></a></small>
      <div class="d-none name"><code>Use-case-for-nplyr.Rmd</code></div>
    </div>

    
    
<p>The package README uses the <a href="https://CRAN.R-project.org/package=gapminder" class="external-link">gapminder
dataset</a> to demonstrate nplyr’s functionality. In this case (and
other similar cases) the output from nplyr’s nested operations could be
obtained by unnesting and performing grouped dplyr operations.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jibarozzo/nplyr" class="external-link">nplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">gm_nest</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">gapminder</span><span class="fu">::</span><span class="va"><a href="https://jennybc.github.io/gapminder/reference/gapminder_unfiltered.html" class="external-link">gapminder_unfiltered</a></span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link">nest</a></span><span class="op">(</span>country_data <span class="op">=</span> <span class="op">-</span><span class="va">continent</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gm_nest</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   continent country_data        </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Asia      <span style="color: #949494;">&lt;tibble [578 × 5]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Europe    <span style="color: #949494;">&lt;tibble [1,302 × 5]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Africa    <span style="color: #949494;">&lt;tibble [637 × 5]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Americas  <span style="color: #949494;">&lt;tibble [470 × 5]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> FSU       <span style="color: #949494;">&lt;tibble [139 × 5]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Oceania   <span style="color: #949494;">&lt;tibble [187 × 5]&gt;</span></span></span>
<span></span>
<span><span class="co"># we can use nplyr to perform operations on the nested data</span></span>
<span><span class="va">gm_nest</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nest_filter.html">nest_filter</a></span><span class="op">(</span><span class="va">country_data</span>, <span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nest_mutate.html">nest_mutate</a></span><span class="op">(</span><span class="va">country_data</span>, pop_millions <span class="op">=</span> <span class="va">pop</span><span class="op">/</span><span class="fl">1000000</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">country_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 43 × 7</span></span></span>
<span><span class="co">#&gt;    continent country           year lifeExp        pop gdpPercap pop_millions</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Asia      Afghanistan       <span style="text-decoration: underline;">2</span>007    43.8   31<span style="text-decoration: underline;">889</span>923      975.       31.9  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Asia      Azerbaijan        <span style="text-decoration: underline;">2</span>007    67.5    8<span style="text-decoration: underline;">017</span>309     <span style="text-decoration: underline;">7</span>709.        8.02 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Asia      Bahrain           <span style="text-decoration: underline;">2</span>007    75.6     <span style="text-decoration: underline;">708</span>573    <span style="text-decoration: underline;">29</span>796.        0.709</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Asia      Bangladesh        <span style="text-decoration: underline;">2</span>007    64.1  150<span style="text-decoration: underline;">448</span>339     <span style="text-decoration: underline;">1</span>391.      150.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Asia      Bhutan            <span style="text-decoration: underline;">2</span>007    65.6    2<span style="text-decoration: underline;">327</span>849     <span style="text-decoration: underline;">4</span>745.        2.33 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Asia      Brunei            <span style="text-decoration: underline;">2</span>007    77.1     <span style="text-decoration: underline;">386</span>511    <span style="text-decoration: underline;">48</span>015.        0.387</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Asia      Cambodia          <span style="text-decoration: underline;">2</span>007    59.7   14<span style="text-decoration: underline;">131</span>858     <span style="text-decoration: underline;">1</span>714.       14.1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Asia      China             <span style="text-decoration: underline;">2</span>007    73.0 <span style="text-decoration: underline;">1</span>318<span style="text-decoration: underline;">683</span>096     <span style="text-decoration: underline;">4</span>959.     <span style="text-decoration: underline;">1</span>319.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Asia      Hong Kong, China  <span style="text-decoration: underline;">2</span>007    82.2    6<span style="text-decoration: underline;">980</span>412    <span style="text-decoration: underline;">39</span>725.        6.98 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Asia      India             <span style="text-decoration: underline;">2</span>007    64.7 <span style="text-decoration: underline;">1</span>110<span style="text-decoration: underline;">396</span>331     <span style="text-decoration: underline;">2</span>452.     <span style="text-decoration: underline;">1</span>110.   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 33 more rows</span></span></span>
<span></span>
<span><span class="co"># in this case, we could have obtained the same result with tidyr and dplyr</span></span>
<span><span class="va">gm_nest</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">country_data</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">continent</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pop_millions <span class="op">=</span> <span class="va">pop</span><span class="op">/</span><span class="fl">1000000</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">continent</span> <span class="op">==</span> <span class="st">"Asia"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 43 × 7</span></span></span>
<span><span class="co">#&gt;    continent country           year lifeExp        pop gdpPercap pop_millions</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Asia      Afghanistan       <span style="text-decoration: underline;">2</span>007    43.8   31<span style="text-decoration: underline;">889</span>923      975.       31.9  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Asia      Azerbaijan        <span style="text-decoration: underline;">2</span>007    67.5    8<span style="text-decoration: underline;">017</span>309     <span style="text-decoration: underline;">7</span>709.        8.02 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Asia      Bahrain           <span style="text-decoration: underline;">2</span>007    75.6     <span style="text-decoration: underline;">708</span>573    <span style="text-decoration: underline;">29</span>796.        0.709</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Asia      Bangladesh        <span style="text-decoration: underline;">2</span>007    64.1  150<span style="text-decoration: underline;">448</span>339     <span style="text-decoration: underline;">1</span>391.      150.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Asia      Bhutan            <span style="text-decoration: underline;">2</span>007    65.6    2<span style="text-decoration: underline;">327</span>849     <span style="text-decoration: underline;">4</span>745.        2.33 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Asia      Brunei            <span style="text-decoration: underline;">2</span>007    77.1     <span style="text-decoration: underline;">386</span>511    <span style="text-decoration: underline;">48</span>015.        0.387</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Asia      Cambodia          <span style="text-decoration: underline;">2</span>007    59.7   14<span style="text-decoration: underline;">131</span>858     <span style="text-decoration: underline;">1</span>714.       14.1  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Asia      China             <span style="text-decoration: underline;">2</span>007    73.0 <span style="text-decoration: underline;">1</span>318<span style="text-decoration: underline;">683</span>096     <span style="text-decoration: underline;">4</span>959.     <span style="text-decoration: underline;">1</span>319.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Asia      Hong Kong, China  <span style="text-decoration: underline;">2</span>007    82.2    6<span style="text-decoration: underline;">980</span>412    <span style="text-decoration: underline;">39</span>725.        6.98 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Asia      India             <span style="text-decoration: underline;">2</span>007    64.7 <span style="text-decoration: underline;">1</span>110<span style="text-decoration: underline;">396</span>331     <span style="text-decoration: underline;">2</span>452.     <span style="text-decoration: underline;">1</span>110.   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 33 more rows</span></span></span></code></pre></div>
<p>Why, then, might we need to use nplyr? Well, in other scenarios, it
may be far more convenient to work with nested data frames or it may not
even be possible to unnest!</p>
<div class="section level2">
<h2 id="a-motivating-example">A motivating example<a class="anchor" aria-label="anchor" href="#a-motivating-example"></a>
</h2>
<p>Consider a set of surveys that an organization might use to gather
market data. It is common for organizations to have separate surveys for
separate purposes but gather the same baseline set of data across all
surveys (for example, a respondent’s age and gender may be recorded
across all surveys, but each survey will have a different set of
questions). Let’s use two fake surveys with the below questions for this
example:</p>
<div class="section level6">
<h6 id="survey-1-job">Survey 1: Job<a class="anchor" aria-label="anchor" href="#survey-1-job"></a>
</h6>
<ol style="list-style-type: decimal">
<li>How old are you? (multiple choice)</li>
<li>What city do you live in? (multiple choice)</li>
<li>What field do you work in? (multiple choice)</li>
<li>Overall, how satisfied are you with your job? (multiple choice)</li>
<li>What is your annual salary? (numeric entry)</li>
</ol>
</div>
<div class="section level6">
<h6 id="survey-2-personal-life">Survey 2: Personal Life<a class="anchor" aria-label="anchor" href="#survey-2-personal-life"></a>
</h6>
<ol style="list-style-type: decimal">
<li>How old are you? (multiple choice)</li>
<li>What city do you live in (multiple choice)</li>
<li>What field do you work in? (multiple choice)</li>
<li>Overall, how satisfied are you with your personal life (multiple
choice)</li>
<li>Please provide additional detail (text entry)</li>
</ol>
<p>In this scenario, both surveys are collecting demographic information
— age, location, and industry — but differ in the questions. A
convenient way to get the response files into the environment would be
to use <a href="https://purrr.tidyverse.org/reference/map.html" class="external-link"><code>purrr::map()</code></a>
to read in each file to a nested data frame.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">path</span> <span class="op">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/markjrieke/nplyr/main/data-raw/"</span></span>
<span></span>
<span><span class="va">surveys</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>survey_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"job_survey"</span>, <span class="st">"personal_survey"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>survey_data <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">survey_file</span>, <span class="op">~</span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">path</span>, <span class="va">.x</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surveys</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;   survey_file     survey_data         </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>              </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> job_survey      <span style="color: #949494;">&lt;spc_tbl_ [500 × 6]&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> personal_survey <span style="color: #949494;">&lt;spc_tbl_ [750 × 6]&gt;</span></span></span></code></pre></div>
<p><a href="https://tidyr.tidyverse.org/reference/nest.html" class="external-link"><code>tidyr::unnest()</code></a>
can usually handle idiosyncrasies in layout when unnesting but in this
case unnesting throws an error!</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `list_unchop()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Can't combine `x[[1]]$Q5` &lt;double&gt; and `x[[2]]$Q5` &lt;character&gt;.</span></span></code></pre></div>
<p>This is because the surveys share column names but not necessarily
column types! In this case, both data frames contain a column named
“Q5”, but in <code>job_survey</code> it’s a double and in
<code>personal_survey</code> it’s a character.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 500</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; $ survey_file <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "job_survey"<span style="color: #949494;">, </span>"job_survey"<span style="color: #949494;">, </span>"job_survey"<span style="color: #949494;">, </span>"job_survey"<span style="color: #949494;">, </span>"j…</span></span>
<span><span class="co">#&gt; $ survey_name <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "job"<span style="color: #949494;">, </span>"job"<span style="color: #949494;">, </span>"job"<span style="color: #949494;">, </span>"job"<span style="color: #949494;">, </span>"job"<span style="color: #949494;">, </span>"job"<span style="color: #949494;">, </span>"job"<span style="color: #949494;">, </span>"job"<span style="color: #949494;">, </span>"j…</span></span>
<span><span class="co">#&gt; $ Q1          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 100<span style="color: #949494;">, </span>81<span style="color: #949494;">, </span>51<span style="color: #949494;">, </span>81<span style="color: #949494;">, </span>80<span style="color: #949494;">, </span>32<span style="color: #949494;">, </span>65<span style="color: #949494;">, </span>57<span style="color: #949494;">, </span>43<span style="color: #949494;">, </span>94<span style="color: #949494;">, </span>25<span style="color: #949494;">, </span>83<span style="color: #949494;">, </span>61<span style="color: #949494;">, </span>66<span style="color: #949494;">, </span>8…</span></span>
<span><span class="co">#&gt; $ Q2          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Austin"<span style="color: #949494;">, </span>"San Antonio"<span style="color: #949494;">, </span>"Austin"<span style="color: #949494;">, </span>"Austin"<span style="color: #949494;">, </span>"Dallas"<span style="color: #949494;">, </span>"Fo…</span></span>
<span><span class="co">#&gt; $ Q3          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Consulting"<span style="color: #949494;">, </span>"Consulting"<span style="color: #949494;">, </span>"Consulting"<span style="color: #949494;">, </span>"Technology"<span style="color: #949494;">, </span>"C…</span></span>
<span><span class="co">#&gt; $ Q4          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Somewhat dissatisfied"<span style="color: #949494;">, </span>"Neither satisfied nor dissatisfi…</span></span>
<span><span class="co">#&gt; $ Q5          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 163<span style="color: #949494;">, </span>48<span style="color: #949494;">, </span>190<span style="color: #949494;">, </span>25<span style="color: #949494;">, </span>143<span style="color: #949494;">, </span>233<span style="color: #949494;">, </span>43<span style="color: #949494;">, </span>243<span style="color: #949494;">, </span>158<span style="color: #949494;">, </span>235<span style="color: #949494;">, </span>245<span style="color: #949494;">, </span>195<span style="color: #949494;">, </span>2…</span></span>
<span></span>
<span><span class="va">surveys</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Rows: 750</span></span>
<span><span class="co">#&gt; Columns: 7</span></span>
<span><span class="co">#&gt; $ survey_file <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "personal_survey"<span style="color: #949494;">, </span>"personal_survey"<span style="color: #949494;">, </span>"personal_survey"<span style="color: #949494;">, </span>"…</span></span>
<span><span class="co">#&gt; $ survey_name <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "personal"<span style="color: #949494;">, </span>"personal"<span style="color: #949494;">, </span>"personal"<span style="color: #949494;">, </span>"personal"<span style="color: #949494;">, </span>"personal"…</span></span>
<span><span class="co">#&gt; $ Q1          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 91<span style="color: #949494;">, </span>32<span style="color: #949494;">, </span>40<span style="color: #949494;">, </span>23<span style="color: #949494;">, </span>88<span style="color: #949494;">, </span>69<span style="color: #949494;">, </span>96<span style="color: #949494;">, </span>40<span style="color: #949494;">, </span>57<span style="color: #949494;">, </span>40<span style="color: #949494;">, </span>39<span style="color: #949494;">, </span>70<span style="color: #949494;">, </span>29<span style="color: #949494;">, </span>38<span style="color: #949494;">, </span>57…</span></span>
<span><span class="co">#&gt; $ Q2          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Austin"<span style="color: #949494;">, </span>"San Antonio"<span style="color: #949494;">, </span>"San Antonio"<span style="color: #949494;">, </span>"Austin"<span style="color: #949494;">, </span>"Dallas"…</span></span>
<span><span class="co">#&gt; $ Q3          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Energy"<span style="color: #949494;">, </span>"Healthcare"<span style="color: #949494;">, </span>"Consulting"<span style="color: #949494;">, </span>"Consulting"<span style="color: #949494;">, </span>"Techn…</span></span>
<span><span class="co">#&gt; $ Q4          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Neither satisfied nor dissatisfied"<span style="color: #949494;">, </span>"Extremely satisfied…</span></span>
<span><span class="co">#&gt; $ Q5          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Blandit eros! A, ligula facilisis imperdiet! Interdum pla…</span></span></code></pre></div>
<p>We could potentially get around this issue with unnesting by reading
in all columns as characters via
<code>readr::read_csv(x, col_types = cols(.default = "c"))</code>, but
this presents its own challenges. <code>Q5</code> would still be better
represented as a double in <code>job_survey</code> and from the survey
question text <code>Q4</code> has similar, but distinctly different,
meanings across the survey files.</p>
<p>This is where nplyr comes into play! Rather than malign the data
types or create separate objects for each survey file, we can use nplyr
to perform operations directly on the nested data frames.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveys</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">surveys</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nest_mutate.html">nest_mutate</a></span><span class="op">(</span><span class="va">survey_data</span>,</span>
<span>              age_group <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">Q1</span> <span class="op">&lt;</span> <span class="fl">65</span>, <span class="st">"Adult"</span>, <span class="st">"Retirement Age"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nest_group_by.html">nest_group_by</a></span><span class="op">(</span><span class="va">survey_data</span>, <span class="va">Q3</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nest_count.html">nest_add_count</a></span><span class="op">(</span><span class="va">survey_data</span>, </span>
<span>                 name <span class="op">=</span> <span class="st">"n_respondents_in_industry"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nest_mutate.html">nest_mutate</a></span><span class="op">(</span><span class="va">survey_data</span>, </span>
<span>              median_industry_age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">Q1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/nest_group_by.html">nest_ungroup</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surveys</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 500 × 10</span></span></span>
<span><span class="co">#&gt;    survey_file survey_name    Q1 Q2          Q3            Q4       Q5 age_group</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> job_survey  job           100 Austin      Consulting    Some…   163 Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> job_survey  job            81 San Antonio Consulting    Neit…    48 Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> job_survey  job            51 Austin      Consulting    Extr…   190 Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> job_survey  job            81 Austin      Technology    Extr…    25 Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> job_survey  job            80 Dallas      Consulting    Extr…   143 Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> job_survey  job            32 Fort Worth  Energy        Some…   233 Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> job_survey  job            65 Dallas      Consulting    Some…    43 Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> job_survey  job            57 Houston     Healthcare    Some…   243 Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> job_survey  job            43 Dallas      Government S… Neit…   158 Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> job_survey  job            94 Fort Worth  Healthcare    Extr…   235 Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 490 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: n_respondents_in_industry &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   median_industry_age &lt;dbl&gt;</span></span></span>
<span></span>
<span><span class="va">surveys</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">survey_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 750 × 10</span></span></span>
<span><span class="co">#&gt;    survey_file     survey_name    Q1 Q2          Q3        Q4    Q5    age_group</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> personal_survey personal       91 Austin      Energy    Neit… Blan… Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> personal_survey personal       32 San Antonio Healthca… Extr… Elem… Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> personal_survey personal       40 San Antonio Consulti… Some… Eget… Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> personal_survey personal       23 Austin      Consulti… Extr… Scel… Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> personal_survey personal       88 Dallas      Technolo… Neit… Aene… Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> personal_survey personal       69 Fort Worth  Technolo… Neit… Inte… Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> personal_survey personal       96 Houston     Healthca… Extr… Blan… Retireme…</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> personal_survey personal       40 Houston     Consulti… Extr… Scel… Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> personal_survey personal       57 Fort Worth  Energy    Extr… Pede… Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> personal_survey personal       40 Fort Worth  Healthca… Extr… Phar… Adult    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 740 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: n_respondents_in_industry &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   median_industry_age &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mark Rieke, Bolívar Aponte Rolón.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
